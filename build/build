ID=$(date | md5 | head -c 8)
echo "[build/id] $ID"

rm -r dist

echo [build] kernel
tsc --project source/system/boot/tsconfig.json
cp source/system/boot/assets/* dist

echo [build] kernel modules
mkdir dist/system/boot/modules
cp source/system/boot/modules/expose.js dist/system/boot/modules/expose.kernel

echo [build] properties
cp -r source/system/properties dist/system/properties

mkdir dist/system/properties/os/build
echo -n $ID > dist/system/properties/os/build/id
date +%s > dist/system/properties/os/build/time

echo [build] system
tsc --project tsconfig.json

echo [build] libraries
node build/glue.js dist/system/libraries/console Console 1.0.0
node build/glue.js dist/system/libraries/fs FileSystem 1.0.0
node build/glue.js dist/system/libraries/system System 1.0.0 /system/libraries/console /system/libraries/fs

rm dist/system/libraries/*.js

echo [build] applications
cp -r source/system/applications dist/system/applications

echo [build] upload to AOSS
node build/upload.js http://prerelease.aoss.os.acryps.com http://fslbs.aoss.os.acryps.com 